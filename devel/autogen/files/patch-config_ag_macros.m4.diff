--- config/ag_macros.m4.orig	2013-10-16 16:46:10.000000000 -0400
+++ config/ag_macros.m4	2014-03-13 14:12:33.000000000 -0400
@@ -1,44 +1,67 @@
-dnl  -*- buffer-read-only: t -*- vi: set ro:
-dnl
-dnl DO NOT EDIT THIS FILE   (ag_macros.m4)
-dnl
-dnl It has been AutoGen-ed  October 16, 2013 at 01:46:10 PM by AutoGen 5.18.2
-dnl From the definitions    misc.def
-dnl and the template file   conftest.tpl
-dnl
-dnl do always before generated macros:
-dnl
+dnl#  -*- buffer-read-only: t -*- vi: set ro:
+dnl#
+dnl# DO NOT EDIT THIS FILE (sorry)   (ag_macros.m4)
+dnl#
+dnl# It was originally AutoGen-ed on October 16, 2013 at 01:46:10 PM
+dnl# by AutoGen 5.18.2
+dnl# From the definitions    misc.def
+dnl# and the template file   conftest.tpl
+dnl#
+dnl# do always before generated macros:
+dnl#
 AC_DEFUN([INVOKE_AG_MACROS_FIRST],[
-  AC_CHECK_HEADERS([libio.h ctype.h assert.h sys/resource.h])
-  AC_CHECK_DECLS([sigsetjmp],,, [#include <setjmp.h>])
-  AC_DECL_SYS_SIGLIST
-  AC_CHECK_FUNCS([putenv getdate_r utimes futimes])
-
-  AC_C_INLINE
-  AC_TYPE_LONG_LONG_INT
-
-  AC_PROG_GREP
-  AC_PROG_EGREP
-  AC_PROG_FGREP
+  AC_CHECK_HEADERS_ONCE([libio.h ctype.h assert.h setjmp.h signal.h \
+                         sys/resource.h])
+  AC_CHECK_DECLS_ONCE([sigsetjmp])
+  unset ac_cv_decl_sigsetjmp
+  unset ac_cv_have_decl_sigsetjmp
+  # do again with correct includes this time:
+  AC_CHECK_DECLS([sigsetjmp],[],[],[#include <setjmp.h>])
+  AC_REQUIRE([AC_HEADER_STDC])
+  AC_CHECK_DECLS_ONCE([sys_siglist])
+  unset ac_cv_decl_sys_siglist
+  unset ac_cv_have_decl_sys_siglist
+  # do again with correct includes this time:
+  AC_CHECK_DECLS([sys_siglist],[],[],[#include <signal.h>
+/* NetBSD declares sys_siglist in unistd.h.  */
+#ifdef HAVE_UNISTD_H
+# include <unistd.h>
+#else
+# if defined(__NetBSD__) || defined(_NETBSD_SOURCE)
+#  warning "this conftest for sys_siglist expects <unistd.h> to be included."
+# endif /* __NetBSD__ || _NETBSD_SOURCE */
+#endif /* HAVE_UNISTD_H */
+])
+  AC_CHECK_FUNCS_ONCE([futimes getdate_r strputenv utimes])
+
+  AC_REQUIRE([AC_C_INLINE])
+  AC_REQUIRE([AC_TYPE_LONG_LONG_INT])
+
+  AC_REQUIRE([AC_PROG_GREP])
+  AC_REQUIRE([AC_PROG_EGREP])
+  AC_REQUIRE([AC_PROG_FGREP])
 ])
 
 
 
-dnl
-dnl do always after generated macros:
-dnl
+dnl#
+dnl# do always after generated macros:
+dnl#
 AC_DEFUN([INVOKE_AG_MACROS_LAST],[
-[if test X${INVOKE_AG_MACROS_LAST_done} != Xyes ; then]
-  INVOKE_LIBOPTS_MACROS
+[if test "X${INVOKE_AG_MACROS_LAST_done}" != "Xyes" ; then]
+  AC_REQUIRE([AC_HEADER_SYS_WAIT])
+  AC_REQUIRE([INVOKE_LIBOPTS_MACROS])
 
-  [echo 'test "X${ac_cv_header_sys_wait_h}" = Xyes' 1>&2
-  test "X${ac_cv_header_sys_wait_h}" = Xyes || \
+  [echo 'test "X${ac_cv_header_sys_wait_h}" = "Xyes"' 1>&2
+  test "X${ac_cv_header_sys_wait_h}" = "Xyes" || \
       ]AC_MSG_ERROR([you must have sys/wait.h on your system])
 
-  AC_CHECK_FUNCS([fopencookie funopen], [break])
+  unset ac_cv_func_fopencookie
+  unset ac_cv_func_funopen
+  AC_CHECK_FUNCS([fopencookie funopen],[break])
   case "${ac_cv_func_fopencookie}${ac_cv_func_funopen}" in
   *yes* )
-     AC_DEFINE([ENABLE_FMEMOPEN], 1, "Define if we can use it")
+     AC_DEFINE([ENABLE_FMEMOPEN],[1],["Define to 1 if we can use it"])
      ;;
   esac
 
@@ -51,144 +74,165 @@
   # matches the existing definitions in stdio.h will succeed for
   # a newlib system.
 
-  if test "X${ac_cv_func_funopen}" = Xyes; then
+  if test "X${ac_cv_func_funopen}" = "Xyes"; then
+    AC_CHECK_HEADERS_ONCE([stdio.h])
+    AC_REQUIRE([AC_TYPE_SIZE_T])
+    AC_REQUIRE([AC_TYPE_SSIZE_T])
     AC_CACHE_CHECK([for cookie_function_t type],
       [ag_cv_cookie_function_t],
-      [AC_TRY_COMPILE([#include <stdio.h>
+      [AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <stdio.h>
         typedef int cookie_read_function_t (void *, char *, int);
-        ], [], ag_cv_cookie_function_t="bsd",
-        AC_TRY_COMPILE([#include <stdio.h>
+        ]],[[]])],[ag_cv_cookie_function_t="bsd"],
+		  [AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <stdio.h>
           typedef ssize_t cookie_read_function_t (void *, char *, size_t);
-          ], [], ag_cv_cookie_function_t="newlib",
-          AC_MSG_ERROR([Unknown flavor of cookie_XXX_t types])))])
+          ]],[[]])],[ag_cv_cookie_function_t="newlib"],
+		    [AC_MSG_ERROR([Unknown flavor of cookie_XXX_t types])
+		  ]) dnl# end of second compile test
+		]) dnl# end of first compile test
+	]) dnl# end of cache check for cookie_function_t type
   fi
-  if test "X${ag_cv_cookie_function_t}" = Xbsd; then
-    AC_DEFINE([NEED_COOKIE_FUNCTION_TYPEDEFS], [1],
+  if test "X${ag_cv_cookie_function_t}" = "Xbsd"; then
+    AC_DEFINE([NEED_COOKIE_FUNCTION_TYPEDEFS],[1],
       [Define if typedefs for the funopen function pointers are required.])
   fi
 
-  AC_CACHE_CHECK([for static inline], [snv_cv_static_inline], [
-  AC_TRY_COMPILE([static inline foo(bar) int bar; { return bar; }],
-    [return foo(0);],
+  AC_REQUIRE([AC_C_INLINE])
+  AC_CACHE_CHECK([for static inline],[snv_cv_static_inline],[
+  dnl# needs to be "_PROGRAM" instead of "_SOURCE":
+  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[static inline foo(bar) int bar; { return bar; }]],
+    [[return foo(0);]])],
     [snv_cv_static_inline='static inline'],
-    [snv_cv_static_inline='static'])
-  ])
-  AC_DEFINE_UNQUOTED(SNV_INLINE, ${snv_cv_static_inline},
+    [snv_cv_static_inline='static']) dnl# end of compile test
+  ]) dnl# end of cache check for static inline
+  AC_DEFINE_UNQUOTED([SNV_INLINE],[${snv_cv_static_inline}],
            [define to static or static inline])
-  [if test "X${libopts_cv_with_libregex}" = Xno
+  [if test "X${libopts_cv_with_libregex}" = "Xno"
   then
     echo "A POSIX compliant regcomp/regexec routine is required.
-  These are required for AutoGen to work correctly.  If you have
+  These are required for AutoGen to work correctly. If you have
   such a library present on your system, you must specify it by
   setting the LIBS environment variable, e.g., \"LIBS='-lregex'\".
   If you do not have such a library on your system, then you should
   download and install, for example, the one from:
       ftp://ftp.gnu.org/gnu/rx/" >&2]
-    AC_MSG_ERROR([Cannot find working POSIX regex library])
+    AC_MSG_ERROR([Cannot find a working POSIX regex library])
   [fi]
-[  INVOKE_AG_MACROS_LAST_done=yes
-fi]])
+[  export INVOKE_AG_MACROS_LAST_done=yes
+fi]
+])
 
-dnl
-dnl @synopsis  INVOKE_AG_MACROS
-dnl
-dnl  This macro will invoke the AutoConf macros specified in misc.def
-dnl  that have not been disabled with "omit-invocation".
-dnl
+dnl#
+dnl# @synopsis  INVOKE_AG_MACROS
+dnl#
+dnl#  This macro will invoke the AutoConf macros specified in misc.def
+dnl#  that have not been disabled with "omit-invocation".
+dnl#
 AC_DEFUN([AG_DISABLE_SHELL],[
   AC_ARG_ENABLE([shell],
-    AS_HELP_STRING([--disable-shell], [shell scripts are desired]),
+    [AS_HELP_STRING([--disable-shell],[shell scripts are desired])],
     [ag_cv_enable_shell=${enable_shell}],
-    AC_CACHE_CHECK([whether shell scripts are desired], ag_cv_enable_shell,
-      ag_cv_enable_shell=yes)
-  ) # end of AC_ARG_ENABLE
-  if test "X${ag_cv_enable_shell}" != Xno
+    [AC_CACHE_CHECK([whether shell scripts are desired],[ag_cv_enable_shell],
+      [ag_cv_enable_shell=yes])
+  ]) dnl# end of AC\_ARG\_ENABLE for "shell"
+  if test "X${ag_cv_enable_shell}" != "Xno"
   then
+    unset ac_cv_func_vfork
+    unset ac_cv_func_vfork_works
     AC_FUNC_FORK
   fi
 
-]) # end of AC_DEFUN of AG_DISABLE_SHELL
+]) dnl# end of AC_DEFUN of AG_DISABLE_SHELL
 
 
 AC_DEFUN([AG_TEST_DO_SHELL],[
-  AC_MSG_CHECKING([whether using shell scripts])
+  AC_MSG_CHECKING([whether we are using shell scripts])
   AC_CACHE_VAL([ag_cv_test_do_shell],[
     ag_cv_test_do_shell=`exec 2> /dev/null
-test "x$ac_cv_func_fork_works" != xyes && \\
-    test "x$ac_cv_func_vfork_works" != xyes && exit 1
-test "x$ag_cv_enable_shell" = xyes || exit 1
+test "x${ac_cv_func_fork_works}" != "xyes" && \\
+    test "x${ac_cv_func_vfork_works}" != "xyes" && exit 1
+test "x${ag_cv_enable_shell}" = "xyes" || exit 1
 echo yes`
-    if test $? -ne 0 || test -z "$ag_cv_test_do_shell"
-    then ag_cv_test_do_shell=no
+    if test $? -ne 0 || test -z "${ag_cv_test_do_shell}"
+      then ag_cv_test_do_shell=no
     fi
-  ]) # end of CACHE_VAL of ag_cv_test_do_shell
+  ]) dnl# end of CACHE_VAL of ag_cv_test_do_shell
   AC_MSG_RESULT([${ag_cv_test_do_shell}])
-  if test "X${ag_cv_test_do_shell}" != Xno
+  if test "X${ag_cv_test_do_shell}" != "Xno"
   then
-    AC_SUBST(OPTS_TESTDIR)
-AC_SUBST(AGEN5_TESTS)
-AC_DEFINE([SHELL_ENABLED], [1], [Define if shell scripts are enabled])
+    AC_SUBST([OPTS_TESTDIR])
+AC_SUBST([AGEN5_TESTS])
+AC_DEFINE([SHELL_ENABLED],[1],[Define if shell scripts are enabled])
 OPTS_TESTDIR=test
 AGEN5_TESTS='$(SHELL_TESTS) $(NOSHELL_TESTS)'
   else
-    OPTS_TESTDIR=
+    OPTS_TESTDIR=""
 AGEN5_TESTS='$(NOSHELL_TESTS)'
   fi
-  AM_CONDITIONAL([DO_SHELL_CMDS],[test "X${ag_cv_test_do_shell}" != Xno])
+  AM_CONDITIONAL([DO_SHELL_CMDS],[test "X${ag_cv_test_do_shell}" != "Xno"])
 
-]) # end of AC_DEFUN of AG_TEST_DO_SHELL
+]) dnl# end of AC_DEFUN of AG_TEST_DO_SHELL
 
 
 AC_DEFUN([AG_LINK_SETJMP],[
+  AC_CHECK_HEADERS_ONCE([setjmp.h])
+  AC_CHECK_FUNCS_ONCE([setjmp])
   AC_MSG_CHECKING([whether setjmp() links okay])
   AC_CACHE_VAL([ag_cv_link_setjmp],[
-  AC_TRY_LINK([@%:@include <setjmp.h>],
-    [jmp_buf bf;
-if (setjmp(bf))
-  return 0;
-return 0;],
-    [ag_cv_link_setjmp=yes],[ag_cv_link_setjmp=no]
-  ) # end of TRY_LINK
-  ]) # end of AC_CACHE_VAL for ag_cv_link_setjmp
+  dnl# needs to be "_PROGRAM" instead of "_SOURCE":
+  AC_LINK_IFELSE([AC_LANG_PROGRAM([[@%:@include <setjmp.h>]],[[
+    jmp_buf bf;
+    if (setjmp(bf)) {
+      return 0;
+    }
+    return 0;
+    ]])],
+    [ag_cv_link_setjmp=yes],
+    [ag_cv_link_setjmp=no]) dnl# end of link test
+  ]) dnl# end of cache val for "ag_cv_link_setjmp"
   AC_MSG_RESULT([${ag_cv_link_setjmp}])
-  if test "X${ag_cv_link_setjmp}" != Xno
+  if test "X${ag_cv_link_setjmp}" != "Xno"
   then
-    AC_DEFINE(HAVE_WORKING_SETJMP, 1, @<:@setjmp links okay@:>@)
+    AC_DEFINE([HAVE_WORKING_SETJMP],[1],[@<:@setjmp links okay@:>@])
   fi
 
-]) # end of AC_DEFUN of AG_LINK_SETJMP
+]) dnl# end of AC_DEFUN of AG_LINK_SETJMP
 
 
 AC_DEFUN([AG_LINK_SIGSETJMP],[
+  AC_CHECK_HEADERS_ONCE([setjmp.h])
+  AC_CHECK_FUNCS_ONCE([sigsetjmp])
   AC_MSG_CHECKING([whether sigsetjmp() links okay])
   AC_CACHE_VAL([ag_cv_link_sigsetjmp],[
-  AC_TRY_LINK([@%:@include <setjmp.h>],
-    [sigjmp_buf bf;
-if (sigsetjmp(bf,0))
-  return 0;
-return 0;],
-    [ag_cv_link_sigsetjmp=yes],[ag_cv_link_sigsetjmp=no]
-  ) # end of TRY_LINK
-  ]) # end of AC_CACHE_VAL for ag_cv_link_sigsetjmp
+  dnl# needs to be "_PROGRAM" instead of "_SOURCE":
+  AC_LINK_IFELSE([AC_LANG_PROGRAM([[@%:@include <setjmp.h>]],[[
+    sigjmp_buf bf;
+    if (sigsetjmp(bf,0)) {
+      return 0;
+    }
+    return 0;
+    ]])],
+    [ag_cv_link_sigsetjmp=yes],
+    [ag_cv_link_sigsetjmp=no]) dnl# end of link test
+  ]) dnl# end of cache val for "ag_cv_link_sigsetjmp"
   AC_MSG_RESULT([${ag_cv_link_sigsetjmp}])
-  if test "X${ag_cv_link_sigsetjmp}" != Xno
+  if test "X${ag_cv_link_sigsetjmp}" != "Xno"
   then
-    AC_DEFINE(HAVE_WORKING_SIGSETJMP, 1, @<:@sigsetjmp links okay@:>@)
+    AC_DEFINE([HAVE_WORKING_SIGSETJMP],[1],[@<:@sigsetjmp links okay@:>@])
   fi
 
-]) # end of AC_DEFUN of AG_LINK_SIGSETJMP
+]) dnl# end of AC_DEFUN of AG_LINK_SIGSETJMP
 
 
 AC_DEFUN([AG_WITHLIB_GUILE],[
   AC_ARG_WITH([libguile],
-    AS_HELP_STRING([--with-libguile], [libguile installation prefix]),
+    [AS_HELP_STRING([--with-libguile],[libguile installation prefix])],
     [ag_cv_with_libguile_root=${with_libguile}],
-    AC_CACHE_CHECK([whether with-libguile was specified], ag_cv_with_libguile_root,
-      ag_cv_with_libguile_root=no)
-  ) # end of AC_ARG_WITH libguile
+    [AC_CACHE_CHECK([whether with-libguile was specified],[ag_cv_with_libguile_root],
+      [ag_cv_with_libguile_root=no])
+  ]) dnl# end of AC_ARG_WITH libguile
 
-  if test "${with_libguile+set}" = set && \
-     test "X${withval}" = Xno
+  if test "X${with_libguile+set}" = "Xset" && \
+     test "X${withval}" = "Xno"
   then ## disabled by request
     ag_cv_with_libguile_root=no
     ag_cv_with_libguile_cflags=no
@@ -196,31 +240,31 @@
   else
 
   AC_ARG_WITH([libguile-cflags],
-    AS_HELP_STRING([--with-libguile-cflags], [libguile compile flags]),
+    [AS_HELP_STRING([--with-libguile-cflags],[libguile compile flags])],
     [ag_cv_with_libguile_cflags=${with_libguile_cflags}],
-    AC_CACHE_CHECK([whether with-libguile-cflags was specified], ag_cv_with_libguile_cflags,
-      ag_cv_with_libguile_cflags=no)
-  ) # end of AC_ARG_WITH libguile-cflags
+    [AC_CACHE_CHECK([whether with-libguile-cflags was specified],[ag_cv_with_libguile_cflags],
+      [ag_cv_with_libguile_cflags=no])
+  ]) dnl# end of AC_ARG_WITH libguile-cflags
 
   AC_ARG_WITH([libguile-libs],
-    AS_HELP_STRING([--with-libguile-libs], [libguile link command arguments]),
+    [AS_HELP_STRING([--with-libguile-libs],[libguile link command arguments])],
     [ag_cv_with_libguile_libs=${with_libguile_libs}],
-    AC_CACHE_CHECK([whether with-libguile-libs was specified], ag_cv_with_libguile_libs,
-      ag_cv_with_libguile_libs=no)
-  ) # end of AC_ARG_WITH libguile-libs
+    [AC_CACHE_CHECK([whether with-libguile-libs was specified],[ag_cv_with_libguile_libs],
+      [ag_cv_with_libguile_libs=no])
+  ]) dnl# end of AC_ARG_WITH libguile-libs
 
   case "X${ag_cv_with_libguile_cflags}" in
   Xyes|Xno|X )
     case "X${ag_cv_with_libguile_root}" in
     Xyes|Xno|X ) ag_cv_with_libguile_cflags=no ;;
-    * )        ag_cv_with_libguile_cflags=-I${ag_cv_with_libguile_root}/include ;;
+    * ) ag_cv_with_libguile_cflags=-I${ag_cv_with_libguile_root}/include ;;
     esac
   esac
   case "X${ag_cv_with_libguile_libs}" in
   Xyes|Xno|X )
     case "X${ag_cv_with_libguile_root}" in
     Xyes|Xno|X ) ag_cv_with_libguile_libs=no ;;
-    * )        ag_cv_with_libguile_libs="-L${ag_cv_with_libguile_root}/lib -lguile";;
+    * ) ag_cv_with_libguile_libs="-L${ag_cv_with_libguile_root}/lib -lguile";;
     esac
   esac
   ag_save_CPPFLAGS="${CPPFLAGS}"
@@ -251,13 +295,14 @@
   esac
   LIBGUILE_CFLAGS=""
   LIBGUILE_LIBS=""
+  AC_CHECK_HEADERS_ONCE([libguile.h])
   AC_MSG_CHECKING([whether libguile can be linked with])
   AC_CACHE_VAL([ag_cv_with_libguile],[
   AC_LINK_IFELSE(
     [AC_LANG_SOURCE([[@%:@include <libguile.h>
 @%:@if ((SCM_MAJOR_VERSION * 100) + SCM_MINOR_VERSION) > 200
 This has not been tested with Guile 2.1.  Remove this line to proceed.
-@%:@endif
+@%:@endif /* Guile 2.1+ */
 int main () {
   SCM fumble = SCM_UNDEFINED;
   SCM bumble = SCM_UNDEFINED;
@@ -271,13 +316,13 @@
   scm_wrong_type_arg( "oops", 1, bumble );
   return 0; }]])],
     [ag_cv_with_libguile=yes],
-    [ag_cv_with_libguile=no]) # end of AC_LINK_IFELSE 
-  ]) # end of AC_CACHE_VAL for ag_cv_with_libguile
+    [ag_cv_with_libguile=no]) dnl# end of AC_LINK_IFELSE
+  ]) dnl# end of AC_CACHE_VAL for ag_cv_with_libguile
   fi ## disabled by request
   AC_MSG_RESULT([${ag_cv_with_libguile}])
     AC_SUBST([LIBGUILE_CFLAGS])
     AC_SUBST([LIBGUILE_LIBS])
-  if test "X${ag_cv_with_libguile}" != Xno
+  if test "X${ag_cv_with_libguile}" != "Xno"
   then[
       LIBGUILE_CFLAGS="${ag_cv_with_libguile_cflags}"
       LIBGUILE_LIBS="${ag_cv_with_libguile_libs}"]
@@ -288,29 +333,33 @@
     LIBS="${ag_save_LIBS}"
       LIBGUILE_CFLAGS=''
       LIBGUILE_LIBS=''
-      AC_MSG_ERROR([Cannot find libguile.  libguile is required.  Perhaps you need to install guile-devel?])
+      AC_MSG_ERROR([Cannot find libguile. libguile is required. If your package manager splits headers into separate "-devel" packages, then perhaps you need to install guile-devel?])
   fi
   AC_SUBST([AG_GUILE])
 
-]) # end of AC_DEFUN of AG_WITHLIB_GUILE
+]) dnl# end of AC_DEFUN of AG_WITHLIB_GUILE
 
 
 AC_DEFUN([AG_WITHCONF_GUILE_VER],[
   AC_ARG_WITH([guile-ver],
-    AS_HELP_STRING([--with-guile-ver], [the guile version is set]),
+    [AS_HELP_STRING([--with-guile-ver],[the guile version is set])],
     [ag_cv_set_guile_ver=${with_guile_ver}],
-    AC_CACHE_CHECK([whether the guile version is set], ag_cv_set_guile_ver,
-      ag_cv_set_guile_ver=no)
-  ) # end of AC_ARG_WITH
-  if test "X${ag_cv_set_guile_ver}" != Xno
+    [AC_CACHE_CHECK([whether the guile version is set],[ag_cv_set_guile_ver],
+      [ag_cv_set_guile_ver=no])
+  ]) dnl# end of AC_ARG_WITH
+  if test "X${ag_cv_set_guile_ver}" != "Xno"
   then
     ag_cv_test_guile_version=${ag_cv_set_guile_ver}
   fi
 
-]) # end of AC_DEFUN of AG_WITHCONF_GUILE_VER
+]) dnl# end of AC_DEFUN of AG_WITHCONF_GUILE_VER
 
 
 AC_DEFUN([AG_TEST_GUILE_VERSION],[
+  AC_REQUIRE([AC_PROG_SED])
+  AC_REQUIRE([AC_PROG_AWK])
+  AC_REQUIRE([AC_PROG_GREP])
+  AC_REQUIRE([AC_PROG_EGREP])
   AC_MSG_CHECKING([whether the guile version])
   AC_CACHE_VAL([ag_cv_test_guile_version],[
     ag_cv_test_guile_version=`exec 2> /dev/null
@@ -341,12 +390,12 @@
   exit 0
 }
 exit 1`
-    if test $? -ne 0 || test -z "$ag_cv_test_guile_version"
+    if test $? -ne 0 || test -z "${ag_cv_test_guile_version}"
     then ag_cv_test_guile_version=no
     fi
-  ]) # end of CACHE_VAL of ag_cv_test_guile_version
+  ]) dnl# end of CACHE_VAL of ag_cv_test_guile_version
   AC_MSG_RESULT([${ag_cv_test_guile_version}])
-  if test "X${ag_cv_test_guile_version}" != Xno
+  if test "X${ag_cv_test_guile_version}" != "Xno"
   then
     set -- `IFS=' .' ; echo ${ag_cv_test_guile_version}`
 i=${3}
@@ -354,25 +403,25 @@
 GUILE_VERSION=`expr ${1} \* 100000 + ${2} \* 1000 + ${i}`
 test ${GUILE_VERSION} -lt 107000 && \
     AC_MSG_ERROR([Guile must be no older than 1.7.x])
-AC_DEFINE_UNQUOTED([GUILE_VERSION], [${GUILE_VERSION}],
+AC_DEFINE_UNQUOTED([GUILE_VERSION],[${GUILE_VERSION}],
          [define to Guile version expression])
 AC_SUBST(GUILE_VERSION)
   else
-    AC_MSG_ERROR(@<:@Cannot determine Guile version number@:>@)
+    AC_MSG_ERROR([@<:@Cannot determine Guile version number@:>@])
   fi
 
-]) # end of AC_DEFUN of AG_TEST_GUILE_VERSION
+]) dnl# end of AC_DEFUN of AG_TEST_GUILE_VERSION
 
 
 AC_DEFUN([AG_WITHLIB_XML2],[
   AC_ARG_WITH([libxml2],
-    AS_HELP_STRING([--with-libxml2], [libxml2 installation prefix]),
+    [AS_HELP_STRING([--with-libxml2],[libxml2 installation prefix])],
     [ag_cv_with_libxml2_root=${with_libxml2}],
-    AC_CACHE_CHECK([whether with-libxml2 was specified], ag_cv_with_libxml2_root,
-      ag_cv_with_libxml2_root=no)
-  ) # end of AC_ARG_WITH libxml2
+    [AC_CACHE_CHECK([whether with-libxml2 was specified],[ag_cv_with_libxml2_root],
+      [ag_cv_with_libxml2_root=no])
+  ]) dnl# end of AC_ARG_WITH libxml2
 
-  if test "${with_libxml2+set}" = set && \
+  if test "X${with_libxml2+set}" = "Xset" && \
      test "X${withval}" = Xno
   then ## disabled by request
     ag_cv_with_libxml2_root=no
@@ -381,31 +430,31 @@
   else
 
   AC_ARG_WITH([libxml2-cflags],
-    AS_HELP_STRING([--with-libxml2-cflags], [libxml2 compile flags]),
+    [AS_HELP_STRING([--with-libxml2-cflags],[libxml2 compile flags])],
     [ag_cv_with_libxml2_cflags=${with_libxml2_cflags}],
-    AC_CACHE_CHECK([whether with-libxml2-cflags was specified], ag_cv_with_libxml2_cflags,
-      ag_cv_with_libxml2_cflags=no)
-  ) # end of AC_ARG_WITH libxml2-cflags
+    [AC_CACHE_CHECK([whether with-libxml2-cflags was specified],[ag_cv_with_libxml2_cflags],
+      [ag_cv_with_libxml2_cflags=no])
+  ]) # end of AC_ARG_WITH libxml2-cflags
 
   AC_ARG_WITH([libxml2-libs],
-    AS_HELP_STRING([--with-libxml2-libs], [libxml2 link command arguments]),
+    [AS_HELP_STRING([--with-libxml2-libs],[libxml2 link command arguments])],
     [ag_cv_with_libxml2_libs=${with_libxml2_libs}],
-    AC_CACHE_CHECK([whether with-libxml2-libs was specified], ag_cv_with_libxml2_libs,
-      ag_cv_with_libxml2_libs=no)
-  ) # end of AC_ARG_WITH libxml2-libs
+    [AC_CACHE_CHECK([whether with-libxml2-libs was specified],[ag_cv_with_libxml2_libs],
+      [ag_cv_with_libxml2_libs=no])
+  ]) # end of AC_ARG_WITH libxml2-libs
 
   case "X${ag_cv_with_libxml2_cflags}" in
   Xyes|Xno|X )
     case "X${ag_cv_with_libxml2_root}" in
     Xyes|Xno|X ) ag_cv_with_libxml2_cflags=no ;;
-    * )        ag_cv_with_libxml2_cflags=-I${ag_cv_with_libxml2_root}/include ;;
+    * ) ag_cv_with_libxml2_cflags=-I${ag_cv_with_libxml2_root}/include ;;
     esac
   esac
   case "X${ag_cv_with_libxml2_libs}" in
   Xyes|Xno|X )
     case "X${ag_cv_with_libxml2_root}" in
     Xyes|Xno|X ) ag_cv_with_libxml2_libs=no ;;
-    * )        ag_cv_with_libxml2_libs="-L${ag_cv_with_libxml2_root}/lib -lxml2";;
+    * ) ag_cv_with_libxml2_libs="-L${ag_cv_with_libxml2_root}/lib -lxml2";;
     esac
   esac
   ag_save_CPPFLAGS="${CPPFLAGS}"
@@ -414,17 +463,24 @@
   Xyes|Xno|X )
     f=`xml2-config --cflags 2>/dev/null` || f=''
     test -n "${f}" && ag_cv_with_libxml2_cflags="${f}" && \
-      AC_MSG_NOTICE([xml2-config used for CFLAGS: $f]) ;;
+      AC_MSG_NOTICE([xml2-config used for CFLAGS: ${f}]) ;;
+  * )
+    test ! -z "${ag_cv_with_libxml2_cflags}"
+    AC_MSG_NOTICE([libxml2 CFLAGS set to ${ag_cv_with_libxml2_cflags}]) ;;
   esac
   case "X${ag_cv_with_libxml2_libs}" in
   Xyes|Xno|X )
     f=`xml2-config --libs 2>/dev/null` || f=''
     test -n "${f}" && ag_cv_with_libxml2_libs="${f}" && \
-      AC_MSG_NOTICE([xml2-config used for LIBS: $f]) ;;
+      AC_MSG_NOTICE([xml2-config used for LIBS: ${f}]) ;;
+  * )
+    test ! -z "${ag_cv_with_libxml2_libs}"
+    AC_MSG_NOTICE([libxml2 LIBS set to ${ag_cv_with_libxml2_libs}]) ;;
   esac
   case "X${ag_cv_with_libxml2_cflags}" in
   Xyes|Xno|X )
-    ag_cv_with_libxml2_cflags="" ;;
+    CPPFLAGS="${CPPFLAGS} -I${prefix}/include/libxml2"
+    ag_cv_with_libxml2_cflags="-I${prefix}/include/libxml2" ;;
   * ) CPPFLAGS="${CPPFLAGS} ${ag_cv_with_libxml2_cflags}" ;;
   esac
   case "X${ag_cv_with_libxml2_libs}" in
@@ -436,6 +492,8 @@
   esac
   LIBXML2_CFLAGS=""
   LIBXML2_LIBS=""
+  AC_CHECK_HEADERS_ONCE([libxml/parser.h libxml/tree.h])
+  AC_CHECK_HEADERS_ONCE([libxml2/libxml/parser.h libxml2/libxml/tree.h])
   AC_MSG_CHECKING([whether libxml2 can be linked with])
   AC_CACHE_VAL([ag_cv_with_libxml2],[
   AC_LINK_IFELSE(
@@ -445,19 +503,19 @@
 int main () {
 xmlDocPtr p = xmlParseFile( "mumble.xml" ); }]])],
     [ag_cv_with_libxml2=yes],
-    [ag_cv_with_libxml2=no]) # end of AC_LINK_IFELSE 
-  ]) # end of AC_CACHE_VAL for ag_cv_with_libxml2
+    [ag_cv_with_libxml2=no]) dnl# end of AC_LINK_IFELSE
+  ]) dnl# end of AC_CACHE_VAL for ag_cv_with_libxml2
   fi ## disabled by request
   AC_MSG_RESULT([${ag_cv_with_libxml2}])
     AC_SUBST([LIBXML2_CFLAGS])
     AC_SUBST([LIBXML2_LIBS])
-  if test "X${ag_cv_with_libxml2}" != Xno
+  if test "X${ag_cv_with_libxml2}" != "Xno"
   then[
       LIBXML2_CFLAGS="${ag_cv_with_libxml2_cflags}"
       LIBXML2_LIBS="${ag_cv_with_libxml2_libs}"]
     CPPFLAGS="@S|@{ag_save_CPPFLAGS}"
     LIBS="@S|@{ag_save_LIBS}"
-    
+
   else
     CPPFLAGS="${ag_save_CPPFLAGS}"
     LIBS="${ag_save_LIBS}"
@@ -465,45 +523,52 @@
       LIBXML2_LIBS=''
   fi
   AC_SUBST([AG_XML2])
-  AM_CONDITIONAL([HAVE_XML_LIB],[test "X${ag_cv_with_libxml2}" != Xno])
+  AC_SUBST([ag_cv_with_libxml2])
+  AC_SUBST([ag_cv_with_libxml2_cflags])
+  AC_SUBST([ag_cv_with_libxml2_libs])
+  AM_CONDITIONAL([HAVE_XML_LIB],[test "X${ag_cv_with_libxml2}" != "Xno"])
 
-]) # end of AC_DEFUN of AG_WITHLIB_XML2
+]) dnl# end of AC_DEFUN of AG_WITHLIB_XML2
 
 
 AC_DEFUN([AG_RUN_SOLARIS_SYSINFO],[
+  AC_CHECK_HEADERS_ONCE([sys/systeminfo.h])
+  AC_CHECK_FUNCS_ONCE([sysinfo])
   AC_MSG_CHECKING([whether sysinfo(2) is Solaris])
   AC_CACHE_VAL([ag_cv_run_solaris_sysinfo],[
-  AC_RUN_IFELSE([@%:@include <sys/systeminfo.h>
+  AC_RUN_IFELSE([AC_LANG_SOURCE([[@%:@include <sys/systeminfo.h>
 int main() { char z@<:@ 256 @:>@;
 long sz = sysinfo(SI_SYSNAME, z, sizeof(z));
-return (sz > 0) ? 0 : 1; }],
-    [ag_cv_run_solaris_sysinfo=yes],[ag_cv_run_solaris_sysinfo=no],[ag_cv_run_solaris_sysinfo=no]
-  ) # end of RUN_IFELSE
-  ]) # end of AC_CACHE_VAL for ag_cv_run_solaris_sysinfo
+return (sz > 0) ? 0 : 1; }]])],
+    [ag_cv_run_solaris_sysinfo=yes],[ag_cv_run_solaris_sysinfo=no],
+	[ag_cv_run_solaris_sysinfo=no]) dnl# end of RUN_IFELSE
+  ]) dnl# end of AC_CACHE_VAL for ag_cv_run_solaris_sysinfo
   AC_MSG_RESULT([${ag_cv_run_solaris_sysinfo}])
-  if test "X${ag_cv_run_solaris_sysinfo}" != Xno
+  if test "X${ag_cv_run_solaris_sysinfo}" != "Xno"
   then
     AC_DEFINE([HAVE_SOLARIS_SYSINFO],[1],
         [Define this if sysinfo(2) is Solaris])
   fi
 
-]) # end of AC_DEFUN of AG_RUN_SOLARIS_SYSINFO
+]) dnl# end of AC_DEFUN of AG_RUN_SOLARIS_SYSINFO
 
 
 AC_DEFUN([AG_RUN_STRCSPN],[
+  AC_REQUIRE([AC_HEADER_STDC])
+  AC_CHECK_FUNCS_ONCE([strcspn])
   AC_MSG_CHECKING([whether strcspn matches prototype and works])
   AC_CACHE_VAL([ag_cv_run_strcspn],[
-  AC_RUN_IFELSE([@%:@include <string.h>
+  AC_RUN_IFELSE([AC_LANG_SOURCE([[@%:@include <string.h>
 int main (int argc, char** argv) {
    char zRej@<:@@:>@ = reject;
    char zAcc@<:@@:>@ = "a-ok-eject";
    return strcspn( zAcc, zRej ) - 5;
-}],
-    [ag_cv_run_strcspn=yes],[ag_cv_run_strcspn=no],[ag_cv_run_strcspn=no]
-  ) # end of RUN_IFELSE
+}]])],
+    [ag_cv_run_strcspn=yes],[ag_cv_run_strcspn=no],
+	[ag_cv_run_strcspn=no]) dnl# end of RUN_IFELSE
   ]) # end of AC_CACHE_VAL for ag_cv_run_strcspn
   AC_MSG_RESULT([${ag_cv_run_strcspn}])
-  if test "X${ag_cv_run_strcspn}" != Xno
+  if test "X${ag_cv_run_strcspn}" != "Xno"
   then
     AC_DEFINE([HAVE_STRCSPN],[1],
         [Define this if strcspn matches prototype and works])
@@ -511,31 +576,41 @@
     COMPATOBJ="@S|@COMPATOBJ strcspn.lo"
   fi
 
-]) # end of AC_DEFUN of AG_RUN_STRCSPN
+]) dnl# end of AC_DEFUN of AG_RUN_STRCSPN
 
 
 AC_DEFUN([AG_RUN_UNAME_SYSCALL],[
+  AC_CHECK_HEADERS_ONCE([sys/utsname.h])
+  AC_CHECK_FUNCS_ONCE([uname])
   AC_MSG_CHECKING([whether uname(2) is POSIX])
   AC_CACHE_VAL([ag_cv_run_uname_syscall],[
-  AC_RUN_IFELSE([@%:@include <sys/utsname.h>
+  AC_RUN_IFELSE([AC_LANG_SOURCE[[@%:@include <sys/utsname.h>
 int main() { struct utsname unm;
-return uname( &unm ); }],
-    [ag_cv_run_uname_syscall=yes],[ag_cv_run_uname_syscall=no],[ag_cv_run_uname_syscall=no]
-  ) # end of RUN_IFELSE
+return uname( &unm ); }]])],
+    [ag_cv_run_uname_syscall=yes],[ag_cv_run_uname_syscall=no],
+	[ag_cv_run_uname_syscall=no]) dnl# end of RUN_IFELSE
   ]) # end of AC_CACHE_VAL for ag_cv_run_uname_syscall
   AC_MSG_RESULT([${ag_cv_run_uname_syscall}])
-  if test "X${ag_cv_run_uname_syscall}" != Xno
+  if test "X${ag_cv_run_uname_syscall}" != "Xno"
   then
     AC_DEFINE([HAVE_UNAME_SYSCALL],[1],
         [Define this if uname(2) is POSIX])
   fi
 
-]) # end of AC_DEFUN of AG_RUN_UNAME_SYSCALL
+]) dnl# end of AC_DEFUN of AG_RUN_UNAME_SYSCALL
 
 
 AC_DEFUN([AG_TEST_LDFLAGS],[
   AC_MSG_CHECKING([whether runtime library dirs can be specified])
   AC_CACHE_VAL([ag_cv_test_ldflags],[
+    if test "x${libdir}" = "x"; then
+      if test "x${prefix}" != "x"; then
+        test -z "${libdir}" && export libdir="${prefix}/lib"
+      else
+        test -z "${prefix}"
+        AC_MSG_WARN([libdir is unset])
+      fi
+    fi
     ag_cv_test_ldflags=`exec 2> /dev/null
 echo 'int main() { return 0; }' > conftest.$ac_ext
 libs="${LIBS}"
@@ -544,7 +619,7 @@
 then echo '-Wl,-R${libdir}' ; rm -f conftest* ; exit 0 ; fi
 LIBS="${libs} -R/tmp"
 if (eval $ac_link) > /dev/null 2>&1
-then echo '-R' ; rm -f conftest* ; exit 0 ; fi
+then echo '-R${libdir}' ; rm -f conftest* ; exit 0 ; fi
 rm -f conftest* ; exit 1`
     if test $? -ne 0 || test -z "$ag_cv_test_ldflags"
     then ag_cv_test_ldflags=no
@@ -559,118 +634,152 @@
   fi
   AC_SUBST([AG_LDFLAGS])
 
-]) # end of AC_DEFUN of AG_TEST_LDFLAGS
+]) dnl# end of AC_DEFUN of AG_TEST_LDFLAGS
 
 
 AC_DEFUN([AG_ENABLE_DEBUG],[
   AC_ARG_ENABLE([debug],
-    AS_HELP_STRING([--enable-debug], [wanting autogen debugging]),
+    [AS_HELP_STRING([--enable-debug],[enable autogen debugging])],
     [ag_cv_enable_debug=${enable_debug}],
-    AC_CACHE_CHECK([whether wanting autogen debugging], ag_cv_enable_debug,
-      ag_cv_enable_debug=no)
-  ) # end of AC_ARG_ENABLE
-  if test "X${ag_cv_enable_debug}" != Xno
-  then
+    [AC_CACHE_CHECK([if we want to debug autogen],[ag_cv_enable_debug],
+      [ag_cv_enable_debug=no])
+  ]) dnl# end of AC_ARG_ENABLE
+  if test "X${ag_cv_enable_debug}" != "Xno"
+  then
+    AC_REQUIRE([AM_WITH_DMALLOC])
+    AC_DEFINE([AUTOGEN_DEBUG_WANTED],[1],
+        [Define this if we are wanting autogen debugging])
     AC_DEFINE([DEBUG_ENABLED],[1],
-        [Define this if wanting autogen debugging])
-    AC_DEFINE([DEBUG_ENABLED], [1],
           [Define this if debugging is enabled])
-    CFLAGS="-g `echo $CFLAGS|sed 's%-g *%%g;s%-O[0-9]* *%%g'`"
+    AC_REQUIRE([AC_PROG_SED])
+    CFLAGS="-g `echo ${CFLAGS}|sed 's%-g *%%g;s%-O[0-9]* *%%g'`"
+    PRE_DEBUG_LIBS="${LIBS}"
     f=`which dmalloc 2>/dev/null`
-    [ -n "$f" ] && LIBS="${LIBS} -ldmalloc"
+    # remember that "test" has to be used explicitly here because brackets
+    # are used for m4 quoting:
+    test -n "${f}" && LIBS="${LIBS} -ldmalloc"
+    AC_REQUIRE([AC_PROG_GREP])
+    if test ! -z "`echo ${LIBS} | grep dmalloc`"; then 
+      AC_CHECK_HEADERS_ONCE([dmalloc.h])
+      AC_CACHE_CHECK([whether libdmalloc can be linked against],
+        [ag_cv_link_dmalloc],
+        [AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include <dmalloc.h>]],[[
+          dmalloc_shutdown();
+          ]])],
+          [ag_cv_link_dmalloc=yes],
+          [ag_cv_link_dmalloc=no]) dnl# end of link test
+        ]) dnl# end of cache check
+      ##
+      if test "X${ag_cv_link_dmalloc}" = "Xno"; then
+        AC_MSG_NOTICE([resetting LIBS to ${PRE_DEBUG_LIBS}])
+        LIBS="${PRE_DEBUG_LIBS}"
+      elif test "X${ag_cv_link_dmalloc}" = "Xyes"; then
+        AC_MSG_NOTICE([dmalloc should now be in LIBS: ${LIBS}])
+      else
+        AC_MSG_WARN(["ag_cv_link_dmalloc" should be either "yes" or "no"])
+        AC_SUBST([ag_cv_link_dmalloc])
+      fi
+    else
+      AC_MSG_NOTICE([dmalloc missing, skipping test for linking with it])
+    fi
+  else
+    AC_MSG_NOTICE([debugging disabled])
   fi
 
-]) # end of AC_DEFUN of AG_ENABLE_DEBUG
+]) dnl# end of AC_DEFUN of AG_ENABLE_DEBUG
 
 
 AC_DEFUN([AG_WITH_GROUP_PACKAGER],[
   AC_ARG_WITH([packager],
-    AS_HELP_STRING([--with-packager], [name of the packager of this software is supplied]),
+    [AS_HELP_STRING([--with-packager],[name of the packager of this software can be supplied here])],
     [ag_cv_with_group_packager=${with_packager}],
-    AC_CACHE_CHECK([whether name of the packager of this software is supplied], ag_cv_with_group_packager,
-      ag_cv_with_group_packager=no)
-  ) # end of AC_ARG_WITH
+    [AC_CACHE_CHECK([if name of the packager of this software is supplied],
+		    [ag_cv_with_group_packager],
+		    [ag_cv_with_group_packager=no])
+  ]) dnl# end of AC_ARG_WITH
   if test "X${ag_cv_with_group_packager}" != Xno
   then
     AC_DEFINE_UNQUOTED([WITH_PACKAGER],["${withval}"],
         [Define this if name of the packager of this software is supplied])
   fi
   AC_ARG_WITH([packager-version],
-    AS_HELP_STRING([--with-packager-version], [packager-specific version information is supplied]),
+    [AS_HELP_STRING([--with-packager-version],[packager-specific version information can be supplied here])],
     [ag_cv_with_group_packager_version=${with_packager_version}],
-    AC_CACHE_CHECK([whether packager-specific version information is supplied], ag_cv_with_group_packager_version,
-      ag_cv_with_group_packager_version=no)
-  ) # end of AC_ARG_WITH
-  if test "X${ag_cv_with_group_packager_version}" != Xno
+    [AC_CACHE_CHECK([if packager-specific version information is supplied],
+	       	    [ag_cv_with_group_packager_version],
+					[ag_cv_with_group_packager_version=no])
+  ]) dnl# end of AC_ARG_WITH
+  if test "X${ag_cv_with_group_packager_version}" != "Xno"
   then
     AC_DEFINE_UNQUOTED([WITH_PACKAGER_VERSION],["${withval}"],
         [Define this if packager-specific version information is supplied])
   fi
   AC_ARG_WITH([packager-bug-reports],
-    AS_HELP_STRING([--with-packager-bug-reports], [bug reporting URI/e-mail/etc. is supplied]),
+    [AS_HELP_STRING([--with-packager-bug-reports],[bug reporting URI/e-mail/etc. can be supplied here])],
     [ag_cv_with_group_packager_bug_reports=${with_packager_bug_reports}],
-    AC_CACHE_CHECK([whether bug reporting URI/e-mail/etc. is supplied], ag_cv_with_group_packager_bug_reports,
-      ag_cv_with_group_packager_bug_reports=no)
-  ) # end of AC_ARG_WITH
-  if test "X${ag_cv_with_group_packager_bug_reports}" != Xno
+    [AC_CACHE_CHECK([whether bug reporting URI/e-mail/etc. is supplied],
+		    [ag_cv_with_group_packager_bug_reports],
+					[ag_cv_with_group_packager_bug_reports=no])
+  ]) dnl# end of AC_ARG_WITH
+  if test "X${ag_cv_with_group_packager_bug_reports}" != "Xno"
   then
     AC_DEFINE_UNQUOTED([WITH_PACKAGER_BUG_REPORTS],["${withval}"],
         [Define this if bug reporting URI/e-mail/etc. is supplied])
   fi
-  if test "X$with_packager" != "X" || \
-    test "X$with_packager_version$with_packager_bug_reports" = "X"
+  if test "X${with_packager}" != "X" || \
+    test "X${with_packager_version}${with_packager_bug_reports}" = "X"
   then :
   else
 
     AC_MSG_ERROR([--with-packager-{bug-reports,version} require --with-packager])
   fi
 
-]) # end of AC_DEFUN of AG_WITH_GROUP_PACKAGER
+]) dnl# end of AC_DEFUN of AG_WITH_GROUP_PACKAGER
 
 
 AC_DEFUN([INVOKE_AG_MACROS],[
   AC_REQUIRE([INVOKE_AG_MACROS_FIRST])
-  # Check to see if shell scripts are desired.
-  AG_DISABLE_SHELL
+  dnl# Check to see if shell scripts are desired.
+  AC_REQUIRE([AG_DISABLE_SHELL])
 
-  # Check to see if using shell scripts.
-  AG_TEST_DO_SHELL
+  dnl# Check to see if using shell scripts.
+  AC_REQUIRE([AG_TEST_DO_SHELL])
 
-  # Check to see if setjmp() links okay.
-  AG_LINK_SETJMP
+  dnl# Check to see if setjmp() links okay.
+  AC_REQUIRE([AG_LINK_SETJMP])
 
-  # Check to see if sigsetjmp() links okay.
-  AG_LINK_SIGSETJMP
+  dnl# Check to see if sigsetjmp() links okay.
+  AC_REQUIRE([AG_LINK_SIGSETJMP])
 
-  # Check to see if prefix for a working libguile installation.
-  AG_WITHLIB_GUILE
+  dnl# Check to see if prefix for a working libguile installation.
+  AC_REQUIRE([AG_WITHLIB_GUILE])
 
-  # Check to see if the guile version is set.
-  AG_WITHCONF_GUILE_VER
+  dnl# Check to see if the guile version is set.
+  AC_REQUIRE([AG_WITHCONF_GUILE_VER])
 
-  # Check to see if the guile version.
-  AG_TEST_GUILE_VERSION
+  dnl# Check to see if the guile version.
+  AC_REQUIRE([AG_TEST_GUILE_VERSION])
 
-  # Check to see if a working libxml2 can be found.
-  AG_WITHLIB_XML2
+  dnl# Check to see if a working libxml2 can be found.
+  AC_REQUIRE([AG_WITHLIB_XML2])
 
-  # Check to see if sysinfo(2) is Solaris.
-  AG_RUN_SOLARIS_SYSINFO
+  dnl# Check to see if sysinfo(2) is Solaris.
+  AC_REQUIRE([AG_RUN_SOLARIS_SYSINFO])
 
-  # Check to see if strcspn matches prototype and works.
-  AG_RUN_STRCSPN
+  dnl# Check to see if strcspn matches prototype and works.
+  AC_REQUIRE([AG_RUN_STRCSPN])
 
-  # Check to see if uname(2) is POSIX.
-  AG_RUN_UNAME_SYSCALL
+  dnl# Check to see if uname(2) is POSIX.
+  AC_REQUIRE([AG_RUN_UNAME_SYSCALL])
 
-  # Check to see if runtime library dirs can be specified.
-  AG_TEST_LDFLAGS
+  dnl# Check to see if runtime library dirs can be specified.
+  AC_REQUIRE([AG_TEST_LDFLAGS])
 
-  # Check to see if wanting autogen debugging.
-  AG_ENABLE_DEBUG
+  dnl# Check to see if wanting autogen debugging.
+  AC_REQUIRE([AG_ENABLE_DEBUG])
 
-  # Check to see if name of the packager of this software is supplied.
-  AG_WITH_GROUP_PACKAGER
+  dnl# Check to see if name of the packager of this software is supplied.
+  AC_REQUIRE([AG_WITH_GROUP_PACKAGER])
 
-  INVOKE_AG_MACROS_LAST
-]) # end AC_DEFUN of INVOKE_AG_MACROS
+  AC_REQUIRE([INVOKE_AG_MACROS_LAST])
+]) dnl# end AC_DEFUN of INVOKE_AG_MACROS
