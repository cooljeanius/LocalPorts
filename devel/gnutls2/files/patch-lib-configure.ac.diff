--- lib/configure.ac.orig	2012-04-22 12:05:34.000000000 -0400
+++ lib/configure.ac	2013-03-25 05:15:44.000000000 -0400
@@ -21,16 +21,29 @@
 # Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
 # MA 02110-1301, USA
 
-AC_PREREQ(2.61)
+AC_PREREQ([2.61])
 AC_INIT([libgnutls], [2.12.19], [bug-gnutls@gnu.org])
+AC_CONFIG_SRCDIR([abstract_int.h])
 AC_CONFIG_AUX_DIR([build-aux])
 AC_CONFIG_MACRO_DIR([m4])
 
-AM_INIT_AUTOMAKE([1.10 -Wall -Werror -Wno-override])
+AM_INIT_AUTOMAKE([1.10 -Wall -Wno-override])
 m4_ifdef([AM_SILENT_RULES], [AM_SILENT_RULES([yes])])
-AM_CONFIG_HEADER(config.h)
+AM_MAINTAINER_MODE
+AC_CONFIG_HEADERS([config.h])
 
+AC_CANONICAL_HOST
+AC_USE_SYSTEM_EXTENSIONS
+
+AM_PROG_AR
+AC_PROG_AWK
 AC_PROG_CC
+AC_PROG_CPP
+AC_PROG_INSTALL
+AC_PROG_LN_S
+AC_PROG_MAKE_SET
+AC_PROG_RANLIB
+PKG_PROG_PKG_CONFIG
 lgl_EARLY
 
 AC_LIBTOOL_WIN32_DLL
@@ -43,44 +56,79 @@
 
 AC_C_BIGENDIAN
 
+# Checks for header files.
+AC_FUNC_ALLOCA
+AC_CHECK_HEADERS([OS.h fcntl.h float.h inttypes.h langinfo.h libintl.h limits.h locale.h malloc.h netdb.h stddef.h stdint.h stdlib.h string.h strings.h sys/ioctl.h sys/param.h sys/socket.h sys/time.h unistd.h wchar.h])
+
+# Checks for typedefs, structures, and compiler characteristics.
+AC_CHECK_HEADER_STDBOOL
+AC_TYPE_UID_T
+AC_C_INLINE
+AC_TYPE_INT16_T
+AC_TYPE_INT32_T
+AC_TYPE_INT64_T
+AC_TYPE_INT8_T
+AC_TYPE_MODE_T
+AC_FUNC_OBSTACK
+AC_TYPE_OFF_T
+AC_TYPE_PID_T
+AC_C_RESTRICT
+AC_TYPE_SIZE_T
+AC_TYPE_UINT16_T
+AC_TYPE_UINT32_T
+AC_TYPE_UINT64_T
+AC_TYPE_UINT8_T
+AC_CHECK_TYPES([ptrdiff_t])
+
+# Checks for library functions.
+AM_GNU_GETTEXT
+AC_FUNC_FSEEKO
+AC_FUNC_MALLOC
+AC_FUNC_MBRTOWC
+AC_FUNC_MMAP
+AC_FUNC_REALLOC
+AC_CHECK_FUNCS([getpagesize gettimeofday isascii localeconv localtime_r mblen mbrlen memchr memmove memset nl_langinfo setlocale socket strcasecmp strchr strdup strerror strncasecmp strrchr strstr strtol strtoul strverscmp])
+
 # For includes/gnutls/gnutls.h.in.
-AC_SUBST(MAJOR_VERSION, `echo $PACKAGE_VERSION | sed 's/\(.*\)\..*\..*/\1/g'`)
-AC_SUBST(MINOR_VERSION, `echo $PACKAGE_VERSION | sed 's/.*\.\(.*\)\..*/\1/g'`)
-AC_SUBST(PATCH_VERSION, `echo $PACKAGE_VERSION | sed 's/.*\..*\.\(.*\)/\1/g'`)
-AC_SUBST(NUMBER_VERSION, `printf "0x%02x%02x%02x" $MAJOR_VERSION $MINOR_VERSION $PATCH_VERSION`)
-AC_CHECK_TYPE(ssize_t,
+AC_SUBST([MAJOR_VERSION], [`echo $PACKAGE_VERSION | sed 's/\(.*\)\..*\..*/\1/g'`])
+AC_SUBST([MINOR_VERSION], [`echo $PACKAGE_VERSION | sed 's/.*\.\(.*\)\..*/\1/g'`])
+AC_SUBST([PATCH_VERSION], [`echo $PACKAGE_VERSION | sed 's/.*\..*\.\(.*\)/\1/g'`])
+AC_SUBST([NUMBER_VERSION], [`printf "0x%02x%02x%02x" $MAJOR_VERSION $MINOR_VERSION $PATCH_VERSION`])
+AC_CHECK_TYPE([ssize_t],
   [
     DEFINE_SSIZE_T="#include <sys/types.h>"
-    AC_SUBST(DEFINE_SSIZE_T)
+    AC_SUBST([DEFINE_SSIZE_T])
   ], [
-    AC_DEFINE(NO_SSIZE_T, 1, [no ssize_t type was found])
+    AC_DEFINE([NO_SSIZE_T], [1], [no ssize_t type was found])
     DEFINE_SSIZE_T="typedef int ssize_t;"
-    AC_SUBST(DEFINE_SSIZE_T)
+    AC_SUBST([DEFINE_SSIZE_T])
   ], [
     #include <sys/types.h>
   ])
+AC_TYPE_SSIZE_T
 
 # For minitasn1.
-AC_CHECK_SIZEOF(unsigned long int, 4)
-AC_CHECK_SIZEOF(unsigned int, 4)
+AC_CHECK_SIZEOF([unsigned long int], [4])
+AC_CHECK_SIZEOF([unsigned int], [4])
 
-AC_ARG_WITH(zlib, AS_HELP_STRING([--without-zlib],
-                                 [disable zlib compression support]),
-            ac_zlib=$withval, ac_zlib=yes)
+AC_ARG_WITH([zlib], [AS_HELP_STRING([--without-zlib],
+                                 [disable zlib compression support])],
+            [ac_zlib=$withval], [ac_zlib=yes])
 AC_MSG_CHECKING([whether to include zlib compression support])
 if test x$ac_zlib != xno; then
- AC_MSG_RESULT(yes)
+ AC_MSG_RESULT([yes])
  AC_LIB_HAVE_LINKFLAGS(z,, [#include <zlib.h>], [compress (0, 0, 0, 0);])
  if test "$ac_cv_libz" != yes; then
-   AC_MSG_WARN(
+   AC_MSG_WARN([
 *** 
-*** ZLIB was not found. You will not be able to use ZLIB compression.)
+*** ZLIB was not found. You will not be able to use ZLIB compression.
+])
  fi
 else
- AC_MSG_RESULT(no)
+ AC_MSG_RESULT([no])
 fi
 
-PKG_CHECK_EXISTS(zlib, ZLIB_HAS_PKGCONFIG=y, ZLIB_HAS_PKGCONFIG=n)
+PKG_CHECK_EXISTS([zlib], [ZLIB_HAS_PKGCONFIG=y], [ZLIB_HAS_PKGCONFIG=n])
 
 if test x$ac_zlib != xno; then
   if test "$ZLIB_HAS_PKGCONFIG" = "y" ; then
@@ -93,18 +141,18 @@
     GNUTLS_ZLIB_LIBS_PRIVATE="$LTLIBZ"
   fi
 fi
-AC_SUBST(GNUTLS_REQUIRES_PRIVATE)
-AC_SUBST(GNUTLS_ZLIB_LIBS_PRIVATE)
+AC_SUBST([GNUTLS_REQUIRES_PRIVATE])
+AC_SUBST([GNUTLS_ZLIB_LIBS_PRIVATE])
 
 dnl Check for p11-kit
-AC_ARG_WITH(p11-kit,
+AC_ARG_WITH([p11-kit],
 	AS_HELP_STRING([--without-p11-kit],
 		[Build without p11-kit and PKCS#11 support]))
 AM_CONDITIONAL(ENABLE_PKCS11, test "$with_p11_kit" != "no")
 if test "$with_p11_kit" != "no"; then
-	PKG_CHECK_MODULES(P11_KIT, [p11-kit-1 >= 0.4], [with_p11_kit=yes], [with_p11_kit=no])
+	PKG_CHECK_MODULES([P11_KIT], [p11-kit-1 >= 0.4], [with_p11_kit=yes], [with_p11_kit=no])
 	if test "$with_p11_kit" != "no";then
-		AC_DEFINE([ENABLE_PKCS11], 1, [Build PKCS#11 support])
+		AC_DEFINE([ENABLE_PKCS11], [1], [Build PKCS#11 support])
 		CFLAGS="$CFLAGS $P11_KIT_CFLAGS"
 		LIBS="$LIBS $P11_KIT_LIBS"
 		if test "x$GNUTLS_REQUIRES_PRIVATE" = "x"; then
@@ -117,28 +165,29 @@
 *** 
 *** p11-kit was not found. PKCS #11 support will be disabled.
 *** You may get it from http://p11-glue.freedesktop.org/p11-kit.html
-*** ]])
+*** 
+]])
 	fi
 fi
 
 lgl_INIT
 
-AC_CHECK_FUNCS(getrusage,,)
-AC_LIB_HAVE_LINKFLAGS(pthread,, [#include <pthread.h>], [pthread_mutex_lock (0);])
+AC_CHECK_FUNCS([getrusage],[],[])
+AC_LIB_HAVE_LINKFLAGS([pthread],[], [#include <pthread.h>], [pthread_mutex_lock (0);])
 
 LIBGNUTLS_LIBS="-L${libdir} -lgnutls $LIBS"
 LIBGNUTLS_CFLAGS="-I${includedir}"
-AC_SUBST(LIBGNUTLS_LIBS)
-AC_SUBST(LIBGNUTLS_CFLAGS)
+AC_SUBST([LIBGNUTLS_LIBS])
+AC_SUBST([LIBGNUTLS_CFLAGS])
 
 # Finish things from ../configure.ac.
 AC_SUBST([WERROR_CFLAGS])
 AC_SUBST([WSTACK_CFLAGS])
 AC_SUBST([WARN_CFLAGS])
 AC_PROG_CXX
-AM_CONDITIONAL(ENABLE_CXX, test "$use_cxx" != "no")
+AM_CONDITIONAL([ENABLE_CXX], [test "$use_cxx" != "no"])
 
-AC_DEFINE([GNUTLS_INTERNAL_BUILD], 1, [We allow temporarily usage of deprecated functions - until they are removed.])
+AC_DEFINE([GNUTLS_INTERNAL_BUILD], [1], [We allow temporarily usage of deprecated functions - until they are removed.])
 
 AC_CONFIG_FILES([
   Makefile
