--- /opt/local/var/macports/sources/rsync.macports.org/release/tarballs/ports/sysutils/MacPorts/Portfile	2013-01-31 12:30:18.000000000 -0500
+++ ./Portfile	2013-02-03 23:53:21.000000000 -0500
@@ -4,6 +4,7 @@
 
 name                MacPorts
 version             2.1.3
+revision            1
 
 categories          sysutils
 platforms           darwin freebsd
@@ -37,8 +38,69 @@
 # clean environment, enable it here.
 configure.args      --enable-readline
 
-# We don't want to use anything supplied by ports when building MacPorts itself.
-configure.env       PATH=/usr/bin:/bin:/usr/sbin:/sbin
+variant mp_deps      description "Use ports supplied by MacPorts to fulfill missing dependencies" {
+depends_build-append port:bsdmake \
+                     port:bzr \
+                     port:gpatch \
+                     port:mercurial \
+                     port:xz \
+                     port:swig-tcl \
+                     port:gnustep-make \
+                     port:gnustep-make-cocoa
+                     #The other gnustep ports are left out because they're broken
+configure.env-append BSDMAKE=${prefix}/bin/bsdmake \
+                     BZR=${prefix}/bin/bzr \
+                     GPATCH=${prefix}/bin/gpatch \
+                     HG=${prefix}/bin/hg \
+                     LZMA=${prefix}/bin/lzma \
+                     SWIG=${prefix}/bin/swig \
+                     XZ=${prefix}/bin/xz \
+                     GNUSTEP_SYSTEM_ROOT=${prefix}/GNUstep \
+                     PATH=${prefix}/bin:/usr/bin:/bin:/usr/sbin:/sbin
+configure.args-append --prefix=${prefix}
+}
+
+variant mp_shadow_deps requires mp_deps description "Use ports supplied by MacPorts as dependencies, even if they shadow standard OS X system tools" {
+depends_build-append port:bzip2 \
+                     port:cpio \
+                     port:file \
+                     port:git-core \
+                     port:cctools \
+                     port:gnutar \
+                     port:gzip \
+                     port:openssl \
+                     port:rsync \
+                     port:subversion \
+                     port:unzip \
+                     path:bin/xar:xar \
+                     port:zip
+    pre-configure {
+        ui_msg "Warning: Using this variant could possibly be dangerous."
+    }
+configure.env-append BZIP2=${prefix}/bin/bzip2 \
+                     FILE=${prefix}/bin/file \
+                     GIT=${prefix}/bin/git \
+                     GNUTAR=${prefix}/bin/gnutar \
+                     GZIP=${prefix}/bin/gzip \
+                     LIPO=${prefix}/bin/lipo \
+                     OPENSSL=${prefix}/bin/openssl \
+                     RSYNC=${prefix}/bin/rsync \
+                     SVN=${prefix}/bin/svn \
+                     UNZIP=${prefix}/bin/unzip \
+                     XAR=${prefix}/bin/xar \
+                     ZIP=${prefix}/bin/zip \
+                     PATH=${prefix}/bin:${prefix}/sbin:/usr/bin:/bin:/usr/sbin:/sbin
+}
+
+if {![variant_isset mp_deps]} {
+    # We don't want to use anything supplied by ports when building MacPorts itself
+    # (unless the user requests the variant specifying otherwise, that is)
+    configure.env       PATH=/usr/bin:/bin:/usr/sbin:/sbin
+
+    # When not using the mp_deps variant, MacPorts' configure removes ${prefix}/bin
+    # from $PATH, so in that case, it's better to not use ccache, to avoid problems.
+    configure.ccache no
+}
 
 # Some of MacPorts' default flags don't play well when we're building MacPorts
 # itself; nuke them.
@@ -50,10 +112,6 @@
 compiler.cpath
 compiler.library_path
 
-# MacPorts' configure removes ${prefix}/bin from $PATH,
-# so better do not use ccache, to avoid problems.
-configure.ccache no
-
 post-destroot {
     # Only install .default versions of config files.
     delete ${destroot}${prefix}/etc/macports/archive_sites.conf
